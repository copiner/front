<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8">
<title>HISTORY</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<script src="./lib/jquery.min.js"></script>
</head>
<body>
<div class="j_scroll scorll-con" >
    <p>你好，china1！</p>
    <p>你好，china2！</p>
    <p>你好，china3！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china！</p>
    <p>你好，china4！</p>
    <p>你好，china5！</p>
    <p>你好，china6！</p>
</div>

<!-- <element onscroll="myScript"> -->
<div class="j_scrolltest scorll-con" style="max-height:100px; border:1px solid black;overflow:scroll;">
  <p>你好，china！</p>
  <p>你好，china！</p>
  <p>你好，china！</p>
  <p>你好，china！</p>
  <p>你好，china！</p>
  <p>你好，china！</p>
  <p>你好，china！</p>
  <p>你好，china！</p>
  <p>你好，china！</p>
  <p>你好，china！</p>
  <p>你好，china！</p>
  <p>你好，china！</p>
  <p>你好，china！</p>
  <p>你好，china！</p>
  <p>你好，china！</p>
  <p>你好，china！</p>
  <p>你好，china！</p>
  <p>你好，china！</p>
  <p>你好，china！</p>
</div>

<div id="show" style="background: #ccc;position: fixed;top: 150px;">

</div>
<script>
//获取窗口可视范围的高度
function getClientHeight(){
    var clientHeight=0;
    if(document.body.clientHeight&&document.documentElement.clientHeight){
        var clientHeight=(document.body.clientHeight<document.documentElement.clientHeight)?document.body.clientHeight:document.documentElement.clientHeight;
    }else{
        var clientHeight=(document.body.clientHeight>document.documentElement.clientHeight)?document.body.clientHeight:document.documentElement.clientHeight;
    }
    return clientHeight;
}

function getScrollTop(){
    var scrollTop=0;
    if(document.documentElement&&document.documentElement.scrollTop){
        scrollTop=document.documentElement.scrollTop;
    }else if(document.body){
        scrollTop=document.body.scrollTop;
    }
    return scrollTop;
}

function getScrollHeight(){
    return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight);
}

function debounce1(fn, wait) {
    var timeout = null;
    return function() {
        if(timeout !== null)   clearTimeout(timeout);
        timeout = setTimeout(fn, wait);
    }
}

var debounce = function(fn, delay) {
  var timer;
  return function () {
    var context = this
    var args = arguments
    clearTimeout(timer)
    timer = setTimeout(function () {
      fn.apply(context, args)
    }, delay)
  }
}

var throttle = function(func, delay) {
    var timer = null;
    return function() {
        var context = this;
        var args = arguments;
        if (!timer) {
            timer = setTimeout(function() {
                func.apply(context, args);
                timer = null;
            }, delay);
        }
    }
}

/*
$(window).scroll(throttle(function(){
  var scrollTop = $(window).scrollTop();
  var scrollHeight = $(document).height();
  var windowHeight = $(window).height();
  // console.log('scrollTop'+scrollTop);
  // console.log('scrollHeight'+scrollHeight);
  // console.log('windowHeight'+windowHeight);
  console.log(scrollHeight - scrollTop - windowHeight <= 100);
  if(scrollHeight - scrollTop - windowHeight <= 100){
      //加载更多
　　}
},300));
*/

//解决多个window.onscroll覆盖的问题
// $(document).ready(function(){
//     //$(window).scroll(function(){console.log(0)});
//     // $(window).scroll(function(){console.log(1)});
// })



/*
绑定在window上的，如果html的高度没有超过整个浏览器高度，
比如设置的是框架大小100%，那么是不会触发滚动的

同样如果绑定在body上，body的高度需要比框架大才行。如果body的高度和框架一样大，
而body内的元素比如一个叫container的div比body高，
那么滚动是在这个container里滚的，绑定在body上的scroll便不会触发。这时候需要绑定在container上
*/

var tbox = document.querySelector('.j_scrolltest');

tbox.onscroll = function () {
    console.log('j_scrolltest');
}


// document.addEventListener('scroll',function(){
//     console.log('first method');
// });
// window.addEventListener('scroll', function(){
//     console.log('first method');
// });


// window.οnscrοll = function(){
//   console.log("1111");
// }


window.addEventListener('scroll', function(){
  console.log("scrolling");
  // 窗口可视范围的高度
  var height=getClientHeight(),
      // 窗口滚动条高度
      theight=getScrollTop(),
      // 窗口可视范围的高度
      rheight=getScrollHeight(),
      // 滚动条距离底部的高度
      bheight=rheight-theight-height;

  document.getElementById('show').innerHTML=
                  '此时浏览器可见区域高度为：'+height
                  +'<br />此时文档内容实际高度为：'+rheight
                  +'<br />此时滚动条距离顶部的高度为：'+theight
                  +'<br />此时滚动条距离底部的高度为：'+bheight;
});

</script>

</body>
</html>
